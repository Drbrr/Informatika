<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kantin Digital</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <header class="hero">
            <div class="hero-content">
                <h1 class="hero-title">KANTIN DIGITAL</h1>
                <p class="hero-subtitle">Pesan makanan dan minuman dengan mudah</p>
                <a href="order.html" class="btn btn-primary btn-lg">
                    <i class="fas fa-utensils"></i> Mulai Pesan
                </a>
            </div>
        </header>

        <main class="container">
            <section class="features">
                <div class="feature-card">
                    <i class="fas fa-hamburger feature-icon"></i>
                    <h3>Menu Lengkap</h3>
                    <p>Berbagai pilihan makanan dan minuman lezat</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-money-bill-wave feature-icon"></i>
                    <h3>Pembayaran Mudah</h3>
                    <p>Bayar dengan QRIS atau tunai</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-history feature-icon"></i>
                    <h3>Riwayat Pesanan</h3>
                    <p>Lihat pesanan sebelumnya dengan mudah</p>
                </div>
            </section>

            <section class="menu-preview">
                <h2 class="section-title">Menu Favorit</h2>
                <div class="menu-cards">
                    <div class="menu-card">
                        <div class="menu-card-image food-1"></div>
                        <div class="menu-card-content">
                            <h3>Nasi Goreng</h3>
                            <p class="menu-price">Rp 15.000</p>
                            <p class="menu-description">Nasi goreng spesial dengan telur dan ayam</p>
                            <a href="order.html" class="btn btn-outline">Pesan Sekarang</a>
                        </div>
                    </div>
                    <div class="menu-card">
                        <div class="menu-card-image food-2"></div>
                        <div class="menu-card-content">
                            <h3>Ayam Geprek</h3>
                            <p class="menu-price">Rp 10.000</p>
                            <p class="menu-description">Ayam geprek pedas dengan sambal spesial</p>
                            <a href="order.html" class="btn btn-outline">Pesan Sekarang</a>
                        </div>
                    </div>
                    <div class="menu-card">
                        <div class="menu-card-image drink-1"></div>
                        <div class="menu-card-content">
                            <h3>Es Jeruk</h3>
                            <p class="menu-price">Rp 6.000</p>
                            <p class="menu-description">Es jeruk segar dengan jeruk pilihan</p>
                            <a href="order.html" class="btn btn-outline">Pesan Sekarang</a>
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <a href="order.html" class="btn btn-primary">Lihat Semua Menu</a>
                </div>
            </section>
        </main>

        <footer class="footer">
            <div class="container">
                <p>&copy; 2024 Kantin Digital. All rights reserved.</p>
                <div class="footer-links">
                    <a href="#" id="show-history">Riwayat Pesanan</a>
                    <a href="#">Bantuan</a>
                    <a href="#">Kontak</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Order History Modal -->
    <div id="history-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Riwayat Pesanan</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body" id="history-list">
                <!-- Order history will be populated here -->
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script src="utils.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Show order history modal
            const historyModal = document.getElementById('history-modal');
            const showHistoryBtn = document.getElementById('show-history');
            const closeBtn = document.querySelector('.close');
            const historyList = document.getElementById('history-list');

            showHistoryBtn.addEventListener('click', function() {
                // Get order history from localStorage
                const orderHistory = JSON.parse(localStorage.getItem('orderHistory') || '[]');
                
                // Clear previous content
                historyList.innerHTML = '';
                
                if (orderHistory.length === 0) {
                    historyList.innerHTML = '<p class="text-center">Belum ada riwayat pesanan.</p>';
                } else {
                    // Display order history
                    orderHistory.forEach((order, index) => {
                        const orderDate = new Date(order.timestamp).toLocaleString('id-ID');
                        const totalPrice = order.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                        
                        const orderElement = document.createElement('div');
                        orderElement.className = 'history-item';
                        
                        let itemsHtml = '';
                        order.items.forEach(item => {
                            itemsHtml += `
                                <div class="history-item-detail">
                                    <span>${item.name} x${item.quantity}</span>
                                    <span>Rp ${formatPrice(item.price * item.quantity)}</span>
                                </div>
                            `;
                        });
                        
                        orderElement.innerHTML = `
                            <div class="history-item-header">
                                <h4>Pesanan #${orderHistory.length - index}</h4>
                                <span>${orderDate}</span>
                            </div>
                            <div class="history-item-content">
                                ${itemsHtml}
                            </div>
                            <div class="history-item-footer">
                                <span>Total: Rp ${formatPrice(totalPrice)}</span>
                                <span>Pembayaran: ${order.paymentMethod}</span>
                            </div>
                            <button class="btn btn-sm btn-outline reorder-btn" data-index="${index}">
                                <i class="fas fa-redo"></i> Pesan Lagi
                            </button>
                        `;
                        
                        historyList.appendChild(orderElement);
                    });
                    
                    // Add event listeners to reorder buttons
                    document.querySelectorAll('.reorder-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const index = parseInt(this.dataset.index);
                            const order = orderHistory[index];
                            
                            // Set current order to this past order
                            localStorage.setItem('orderItems', JSON.stringify(order.items));
                            localStorage.setItem('paymentMethod', order.paymentMethod);
                            
                            // Show toast and redirect
                            showToast('Pesanan ditambahkan ke keranjang!');
                            setTimeout(() => {
                                window.location.href = 'order.html';
                            }, 1000);
                        });
                    });
                }
                
                historyModal.style.display = 'block';
            });

            closeBtn.addEventListener('click', function() {
                historyModal.style.display = 'none';
            });

            window.addEventListener('click', function(event) {
                if (event.target === historyModal) {
                    historyModal.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>