<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesan - Kantin Digital</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <nav class="navbar">
            <div class="container">
                <a href="index.html" class="navbar-brand">
                    <i class="fas fa-utensils"></i> Kantin Digital
                </a>
                <div class="navbar-links">
                    <a href="index.html">Beranda</a>
                    <a href="#" id="show-history">Riwayat</a>
                    <a href="#" id="cart-icon" class="cart-icon">
                        <i class="fas fa-shopping-cart"></i>
                        <span id="cart-count" class="cart-count">0</span>
                    </a>
                </div>
            </div>
        </nav>

        <main class="container">
            <h1 class="page-title">Menu Pesanan</h1>
            
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="search-input" placeholder="Cari menu...">
                    <button id="clear-search" class="clear-search">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <div class="order-grid">
                <!-- Menu Selection Section -->
                <div class="menu-section">
                    <div class="tabs">
                        <button class="tab-btn active" id="food-tab-btn">
                            <i class="fas fa-hamburger"></i> Makanan
                        </button>
                        <button class="tab-btn" id="drink-tab-btn">
                            <i class="fas fa-coffee"></i> Minuman
                        </button>
                        <button class="tab-btn" id="payment-tab-btn">
                            <i class="fas fa-wallet"></i> Pembayaran
                        </button>
                    </div>

                    <!-- Food Menu Tab -->
                    <div class="tab-content active" id="food-tab">
                        <div class="menu-items" id="food-items">
                            <div class="menu-item" data-id="1" data-name="Nasi Goreng" data-price="15000" data-category="food">
                                <div class="menu-item-image food-1"></div>
                                <div class="menu-item-details">
                                    <h3>Nasi Goreng</h3>
                                    <p class="menu-item-price">Rp 15.000</p>
                                    <p class="menu-item-description">Nasi goreng spesial dengan telur dan ayam</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                            <div class="menu-item" data-id="2" data-name="Mie Goreng" data-price="12000" data-category="food">
                                <div class="menu-item-image food-2"></div>
                                <div class="menu-item-details">
                                    <h3>Mie Goreng</h3>
                                    <p class="menu-item-price">Rp 12.000</p>
                                    <p class="menu-item-description">Mie goreng dengan telur dan sayuran</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                            <div class="menu-item" data-id="3" data-name="Ayam Geprek" data-price="10000" data-category="food">
                                <div class="menu-item-image food-3"></div>
                                <div class="menu-item-details">
                                    <h3>Ayam Geprek</h3>
                                    <p class="menu-item-price">Rp 10.000</p>
                                    <p class="menu-item-description">Ayam geprek pedas dengan sambal spesial</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                            <div class="menu-item" data-id="4" data-name="Sate Ayam" data-price="20000" data-category="food">
                                <div class="menu-item-image food-4"></div>
                                <div class="menu-item-details">
                                    <h3>Sate Ayam</h3>
                                    <p class="menu-item-price">Rp 20.000</p>
                                    <p class="menu-item-description">Sate ayam dengan bumbu kacang</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                            <div class="menu-item" data-id="5" data-name="Sate Sapi" data-price="22000" data-category="food">
                                <div class="menu-item-image food-5"></div>
                                <div class="menu-item-details">
                                    <h3>Sate Sapi</h3>
                                    <p class="menu-item-price">Rp 22.000</p>
                                    <p class="menu-item-description">Sate sapi dengan bumbu kacang spesial</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Drink Menu Tab -->
                    <div class="tab-content" id="drink-tab">
                        <div class="menu-items" id="drink-items">
                            <div class="menu-item" data-id="1" data-name="Es Teh" data-price="5000" data-category="drink">
                                <div class="menu-item-image drink-1"></div>
                                <div class="menu-item-details">
                                    <h3>Es Teh</h3>
                                    <p class="menu-item-price">Rp 5.000</p>
                                    <p class="menu-item-description">Es teh manis segar</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                            <div class="menu-item" data-id="2" data-name="Es Jeruk" data-price="6000" data-category="drink">
                                <div class="menu-item-image drink-2"></div>
                                <div class="menu-item-details">
                                    <h3>Es Jeruk</h3>
                                    <p class="menu-item-price">Rp 6.000</p>
                                    <p class="menu-item-description">Es jeruk segar dengan jeruk pilihan</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                            <div class="menu-item" data-id="3" data-name="Susu Coklat" data-price="8000" data-category="drink">
                                <div class="menu-item-image drink-3"></div>
                                <div class="menu-item-details">
                                    <h3>Susu Coklat</h3>
                                    <p class="menu-item-price">Rp 8.000</p>
                                    <p class="menu-item-description">Susu coklat dingin</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                            <div class="menu-item" data-id="4" data-name="Susu Vanilla" data-price="8000" data-category="drink">
                                <div class="menu-item-image drink-4"></div>
                                <div class="menu-item-details">
                                    <h3>Susu Vanilla</h3>
                                    <p class="menu-item-price">Rp 8.000</p>
                                    <p class="menu-item-description">Susu vanilla dingin</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                            <div class="menu-item" data-id="5" data-name="Air Mineral" data-price="4000" data-category="drink">
                                <div class="menu-item-image drink-5"></div>
                                <div class="menu-item-details">
                                    <h3>Air Mineral</h3>
                                    <p class="menu-item-price">Rp 4.000</p>
                                    <p class="menu-item-description">Air mineral segar</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Method Tab -->
                    <div class="tab-content" id="payment-tab">
                        <div class="payment-methods">
                            <h3 class="section-title">Pilih Metode Pembayaran</h3>
                            
                            <div class="payment-option" data-payment="QRIS">
                                <input type="radio" id="qris" name="payment" value="QRIS">
                                <label for="qris">
                                    <i class="fas fa-qrcode"></i>
                                    <span>QRIS</span>
                                    <p class="payment-description">Bayar dengan scan QR code</p>
                                </label>
                            </div>
                            
                            <div class="payment-option" data-payment="CASH">
                                <input type="radio" id="cash" name="payment" value="CASH">
                                <label for="cash">
                                    <i class="fas fa-money-bill-wave"></i>
                                    <span>CASH</span>
                                    <p class="payment-description">Bayar dengan uang tunai</p>
                                </label>
                            </div>

                            <div class="discount-section">
                                <h3 class="section-title">Kode Promo</h3>
                                <div class="discount-input">
                                    <input type="text" id="discount-code" placeholder="Masukkan kode promo">
                                    <button id="apply-discount" class="btn btn-outline">Terapkan</button>
                                </div>
                                <p id="discount-message" class="discount-message"></p>
                            </div>
                        </div>
                    </div>

                    <div class="tab-navigation">
                        <button id="prev-tab" class="btn btn-outline">
                            <i class="fas fa-arrow-left"></i> Sebelumnya
                        </button>
                        <button id="next-tab" class="btn btn-primary">
                            Selanjutnya <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Order Summary Section -->
                <div class="order-summary" id="order-summary">
                    <div class="summary-header">
                        <h2>Ringkasan Pesanan</h2>
                        <button id="clear-cart" class="btn btn-text">
                            <i class="fas fa-trash"></i> Kosongkan
                        </button>
                    </div>
                    
                    <div id="order-items" class="order-items">
                        <p class="empty-order">Belum Ada Pesanan</p>
                    </div>
                    
                    <div class="summary-details">
                        <div class="summary-row">
                            <span>Subtotal</span>
                            <span id="subtotal">Rp 0</span>
                        </div>
                        <div class="summary-row" id="discount-row" style="display: none;">
                            <span>Diskon</span>
                            <span id="discount-amount">-Rp 0</span>
                        </div>
                        <div class="summary-row total">
                            <span>Total</span>
                            <span id="total-price">Rp 0</span>
                        </div>
                    </div>
                    
                    <div class="payment-info">
                        <i class="fas fa-wallet"></i>
                        <span>Metode Pembayaran:</span>
                        <span id="selected-payment">Belum Memilih</span>
                    </div>
                    
                    <button id="confirm-order" class="btn btn-primary btn-lg btn-full">
                        <i class="fas fa-check-circle"></i> Konfirmasi Pesanan
                    </button>
                </div>
            </div>
        </main>

        <footer class="footer">
            <div class="container">
                <p>&copy; 2024 Kantin Digital. All rights reserved.</p>
                <div class="footer-links">
                    <a href="#">Bantuan</a>
                    <a href="#">Kontak</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Mobile Cart Button -->
    <button id="mobile-cart-btn" class="mobile-cart-btn">
        <i class="fas fa-shopping-cart"></i>
        <span id="mobile-cart-count">0</span>
    </button>

    <!-- Order History Modal -->
    <div id="history-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Riwayat Pesanan</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body" id="history-list">
                <!-- Order history will be populated here -->
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Konfirmasi Pesanan</h2>
                <span class="close-confirm">&times;</span>
            </div>
            <div class="modal-body">
                <p>Apakah Anda yakin ingin mengonfirmasi pesanan ini?</p>
                <div class="modal-buttons">
                    <button id="cancel-confirm" class="btn btn-outline">Batal</button>
                    <button id="proceed-confirm" class="btn btn-primary">Ya, Konfirmasi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Clear Cart Modal -->
    <div id="clear-cart-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Kosongkan Keranjang</h2>
                <span class="close-clear-cart">&times;</span>
            </div>
            <div class="modal-body">
                <p>Apakah Anda yakin ingin mengosongkan keranjang?</p>
                <div class="modal-buttons">
                    <button id="cancel-clear" class="btn btn-outline">Batal</button>
                    <button id="proceed-clear" class="btn btn-primary">Ya, Kosongkan</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
    // Format price with thousand separators
    function formatPrice(price) {
      return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")
    }

    // Show toast notification
    function showToast(message, duration = 3000) {
      const toast = document.getElementById("toast")
      toast.textContent = message
      toast.classList.add("show")

      setTimeout(() => {
        toast.classList.remove("show")
      }, duration)
    }

    document.addEventListener("DOMContentLoaded", () => {
      // Initialize order data from localStorage or create empty arrays
      let orderItems = JSON.parse(localStorage.getItem("orderItems") || "[]")
      let paymentMethod = localStorage.getItem("paymentMethod") || ""
      let discountAmount = Number.parseInt(localStorage.getItem("discountAmount") || "0")

      // Check URL parameters for initial tab
      const urlParams = new URLSearchParams(window.location.search)
      const initialTab = urlParams.get("tab")

      // Tab navigation
      const tabButtons = document.querySelectorAll(".tab-btn")
      const tabContents = document.querySelectorAll(".tab-content")
      const nextTabBtn = document.getElementById("next-tab")
      const prevTabBtn = document.getElementById("prev-tab")
      let currentTabIndex = 0

      // Update UI based on stored data
      updateOrderSummary()
      updatePaymentDisplay()
      updateCartCount()

      // Tab functionality
      function showTab(index) {
        tabButtons.forEach((btn) => btn.classList.remove("active"))
        tabContents.forEach((content) => content.classList.remove("active"))

        tabButtons[index].classList.add("active")
        tabContents[index].classList.add("active")
        currentTabIndex = index

        // Update navigation buttons
        prevTabBtn.style.visibility = index === 0 ? "hidden" : "visible"
        nextTabBtn.style.visibility = index === tabButtons.length - 1 ? "hidden" : "visible"
      }

      // Initialize with first tab or specified tab from URL
      if (initialTab === "drink") {
        showTab(1) // Show drinks tab (index 1)
      } else if (initialTab === "payment") {
        showTab(2) // Show payment tab (index 2)
      } else {
        showTab(0) // Default to food tab (index 0)
      }

      // Direct tab button click handlers
      document.getElementById("food-tab-btn").addEventListener("click", () => showTab(0))
      document.getElementById("drink-tab-btn").addEventListener("click", () => showTab(1))
      document.getElementById("payment-tab-btn").addEventListener("click", () => showTab(2))

      // Next/Previous tab navigation
      nextTabBtn.addEventListener("click", () => {
        if (currentTabIndex < tabButtons.length - 1) {
          showTab(currentTabIndex + 1)
        }
      })

      prevTabBtn.addEventListener("click", () => {
        if (currentTabIndex > 0) {
          showTab(currentTabIndex - 1)
        }
      })

      // Quantity control
      const quantityBtns = document.querySelectorAll(".quantity-btn")
      quantityBtns.forEach((btn) => {
        btn.addEventListener("click", function () {
          const input = this.parentElement.querySelector(".quantity-input")
          let value = Number.parseInt(input.value)

          if (this.classList.contains("plus")) {
            value = Math.min(value + 1, 10)
          } else if (this.classList.contains("minus")) {
            value = Math.max(value - 1, 1)
          }

          input.value = value
        })
      })

      // Add item to order
      const addButtons = document.querySelectorAll(".add-item")
      addButtons.forEach((button) => {
        button.addEventListener("click", function () {
          const menuItem = this.closest(".menu-item")
          const id = menuItem.dataset.id
          const name = menuItem.dataset.name
          const price = menuItem.dataset.price
          const category = menuItem.dataset.category
          const quantityInput = menuItem.querySelector(".quantity-input")
          const quantity = Number.parseInt(quantityInput.value)

          // Check if item already exists in order
          const existingItemIndex = orderItems.findIndex((item) => item.id === id && item.category === category)

          if (existingItemIndex !== -1) {
            // Update quantity if item exists
            orderItems[existingItemIndex].quantity += quantity
          } else {
            // Add new item
            orderItems.push({ id, name, price, category, quantity })
          }

          localStorage.setItem("orderItems", JSON.stringify(orderItems))

          // Reset quantity input
          quantityInput.value = 1

          // Show toast notification
          showToast(`${name} ditambahkan ke pesanan!`)

          updateOrderSummary()
          updateCartCount()
          checkConfirmButton()
        })
      })

      // Payment method selection
      const paymentOptions = document.querySelectorAll('input[name="payment"]')
      paymentOptions.forEach((option) => {
        // Set checked state based on stored payment method
        if (option.value === paymentMethod) {
          option.checked = true
        }

        option.addEventListener("change", function () {
          if (this.checked) {
            paymentMethod = this.value
            localStorage.setItem("paymentMethod", paymentMethod)
            updatePaymentDisplay()
            checkConfirmButton()
            showToast(`Metode pembayaran diubah ke ${paymentMethod}`)
          }
        })
      })

      // Discount code
      const discountCodeInput = document.getElementById("discount-code")
      const applyDiscountBtn = document.getElementById("apply-discount")
      const discountMessage = document.getElementById("discount-message")

      applyDiscountBtn.addEventListener("click", () => {
        const code = discountCodeInput.value.trim().toUpperCase()

        if (code === "DISKON10") {
          // Calculate 10% discount
          const subtotal = orderItems.reduce((total, item) => total + Number.parseInt(item.price) * item.quantity, 0)
          discountAmount = Math.round(subtotal * 0.1)
          localStorage.setItem("discountAmount", discountAmount.toString())

          discountMessage.textContent = "Diskon 10% berhasil diterapkan!"
          discountMessage.style.color = "green"

          showToast("Kode promo berhasil diterapkan!")

          updateOrderSummary()
        } else if (code === "DISKON20") {
          // Calculate 20% discount
          const subtotal = orderItems.reduce((total, item) => total + Number.parseInt(item.price) * item.quantity, 0)
          discountAmount = Math.round(subtotal * 0.2)
          localStorage.setItem("discountAmount", discountAmount.toString())

          discountMessage.textContent = "Diskon 20% berhasil diterapkan!"
          discountMessage.style.color = "green"

          showToast("Kode promo berhasil diterapkan!")

          updateOrderSummary()
        } else {
          discountMessage.textContent = "Kode promo tidak valid."
          discountMessage.style.color = "red"
        }
      })

      // Confirm order button
      const confirmOrderBtn = document.getElementById("confirm-order")
      const confirmModal = document.getElementById("confirm-modal")
      const closeConfirmBtn = document.querySelector(".close-confirm")
      const cancelConfirmBtn = document.getElementById("cancel-confirm")
      const proceedConfirmBtn = document.getElementById("proceed-confirm")

      confirmOrderBtn.addEventListener("click", () => {
        if (orderItems.length > 0 && paymentMethod) {
          confirmModal.style.display = "block"
        } else {
          if (orderItems.length === 0) {
            showToast("Silakan pilih menu terlebih dahulu!")
          } else if (!paymentMethod) {
            showToast("Silakan pilih metode pembayaran!")
            showTab(2) // Show payment tab
          }
        }
      })

      closeConfirmBtn.addEventListener("click", () => {
        confirmModal.style.display = "none"
      })

      cancelConfirmBtn.addEventListener("click", () => {
        confirmModal.style.display = "none"
      })

      proceedConfirmBtn.addEventListener("click", () => {
        // Save order time
        localStorage.setItem("orderTime", new Date().toISOString())

        // Redirect to confirmation page
        window.location.href = "confirmation.html"
      })

      // Clear cart button
      const clearCartBtn = document.getElementById("clear-cart")
      const clearCartModal = document.getElementById("clear-cart-modal")
      const closeClearCartBtn = document.querySelector(".close-clear-cart")
      const cancelClearBtn = document.getElementById("cancel-clear")
      const proceedClearBtn = document.getElementById("proceed-clear")

      clearCartBtn.addEventListener("click", () => {
        if (orderItems.length > 0) {
          clearCartModal.style.display = "block"
        }
      })

      closeClearCartBtn.addEventListener("click", () => {
        clearCartModal.style.display = "none"
      })

      cancelClearBtn.addEventListener("click", () => {
        clearCartModal.style.display = "none"
      })

      proceedClearBtn.addEventListener("click", () => {
        orderItems = []
        localStorage.setItem("orderItems", JSON.stringify(orderItems))

        discountAmount = 0
        localStorage.setItem("discountAmount", "0")

        updateOrderSummary()
        updateCartCount()
        checkConfirmButton()

        clearCartModal.style.display = "none"
        showToast("Keranjang berhasil dikosongkan!")
      })

      // Search functionality
      const searchInput = document.getElementById("search-input")
      const clearSearchBtn = document.getElementById("clear-search")

      searchInput.addEventListener("input", function () {
        const searchTerm = this.value.toLowerCase().trim()

        if (searchTerm) {
          clearSearchBtn.style.display = "block"
        } else {
          clearSearchBtn.style.display = "none"
        }

        // Filter food items
        const foodItems = document.querySelectorAll("#food-items .menu-item")
        foodItems.forEach((item) => {
          const name = item.dataset.name.toLowerCase()
          if (name.includes(searchTerm)) {
            item.style.display = "grid"
          } else {
            item.style.display = "none"
          }
        })

        // Filter drink items
        const drinkItems = document.querySelectorAll("#drink-items .menu-item")
        drinkItems.forEach((item) => {
          const name = item.dataset.name.toLowerCase()
          if (name.includes(searchTerm)) {
            item.style.display = "grid"
          } else {
            item.style.display = "none"
          }
        })
      })

      clearSearchBtn.addEventListener("click", () => {
        searchInput.value = ""
        clearSearchBtn.style.display = "none"

        // Show all items
        const allItems = document.querySelectorAll(".menu-item")
        allItems.forEach((item) => {
          item.style.display = "grid"
        })
      })

      // Mobile cart button
      const mobileCartBtn = document.getElementById("mobile-cart-btn")
      const orderSummary = document.getElementById("order-summary")

      mobileCartBtn.addEventListener("click", () => {
        orderSummary.classList.toggle("show-mobile")
      })

      // History modal
      setupHistoryModal()

      // Update order summary display
      function updateOrderSummary() {
        const orderItemsContainer = document.getElementById("order-items")
        const subtotalElement = document.getElementById("subtotal")
        const discountRow = document.getElementById("discount-row")
        const discountAmountElement = document.getElementById("discount-amount")
        const totalPriceElement = document.getElementById("total-price")

        // Clear current items
        orderItemsContainer.innerHTML = ""

        if (orderItems.length === 0) {
          orderItemsContainer.innerHTML = '<p class="empty-order">Belum Ada Pesanan</p>'
          subtotalElement.textContent = "Rp 0"
          totalPriceElement.textContent = "Rp 0"
          discountRow.style.display = "none"
          return
        }

        // Calculate subtotal
        let subtotal = 0

        // Add each item to the display
        orderItems.forEach((item, index) => {
          const price = Number.parseInt(item.price)
          const itemTotal = price * item.quantity
          subtotal += itemTotal

          const itemElement = document.createElement("div")
          itemElement.className = "order-item"
          itemElement.innerHTML = `
                    <div class="order-item-details">
                        <div class="order-item-name">${item.name}</div>
                        <div class="order-item-price">Rp ${formatPrice(price)} x ${item.quantity}</div>
                    </div>
                    <div class="order-item-total">Rp ${formatPrice(itemTotal)}</div>
                    <button class="remove-item" data-index="${index}">
                        <i class="fas fa-times"></i>
                    </button>
                `
          orderItemsContainer.appendChild(itemElement)
        })

        // Update subtotal
        subtotalElement.textContent = `Rp ${formatPrice(subtotal)}`

        // Update discount if applicable
        if (discountAmount > 0) {
          discountRow.style.display = "flex"
          discountAmountElement.textContent = `-Rp ${formatPrice(discountAmount)}`
        } else {
          discountRow.style.display = "none"
        }

        // Calculate and update total price
        const totalPrice = subtotal - discountAmount
        totalPriceElement.textContent = `Rp ${formatPrice(totalPrice)}`

        // Add event listeners to remove buttons
        const removeButtons = document.querySelectorAll(".remove-item")
        removeButtons.forEach((button) => {
          button.addEventListener("click", function () {
            const index = Number.parseInt(this.dataset.index)
            const removedItem = orderItems[index]

            orderItems.splice(index, 1)
            localStorage.setItem("orderItems", JSON.stringify(orderItems))

            showToast(`${removedItem.name} dihapus dari pesanan!`)

            updateOrderSummary()
            updateCartCount()
            checkConfirmButton()
          })
        })
      }

      // Update payment method display
      function updatePaymentDisplay() {
        const paymentDisplay = document.getElementById("selected-payment")
        paymentDisplay.textContent = paymentMethod || "Belum Memilih"
      }

      // Update cart count
      function updateCartCount() {
        const cartCount = document.getElementById("cart-count")
        const mobileCartCount = document.getElementById("mobile-cart-count")
        const totalItems = orderItems.reduce((total, item) => total + item.quantity, 0)

        cartCount.textContent = totalItems
        mobileCartCount.textContent = totalItems

        if (totalItems > 0) {
          mobileCartBtn.style.display = "flex"
        } else {
          mobileCartBtn.style.display = "none"
        }
      }

      // Check if confirm button should be enabled
      function checkConfirmButton() {
        const confirmBtn = document.getElementById("confirm-order")
        confirmBtn.disabled = !(orderItems.length > 0 && paymentMethod)
      }

      // Setup history modal
      function setupHistoryModal() {
        const historyModal = document.getElementById("history-modal")
        const showHistoryBtn = document.getElementById("show-history")
        const closeBtn = document.querySelector(".close")
        const historyList = document.getElementById("history-list")

        function showHistory() {
          // Get order history from localStorage
          const orderHistory = JSON.parse(localStorage.getItem("orderHistory") || "[]")

          // Clear previous content
          historyList.innerHTML = ""

          if (orderHistory.length === 0) {
            historyList.innerHTML = '<p class="text-center">Belum ada riwayat pesanan.</p>'
          } else {
            // Display order history
            orderHistory.forEach((order, index) => {
              const orderDate = new Date(order.timestamp).toLocaleString("id-ID")
              const subtotal = order.items.reduce((sum, item) => sum + Number.parseInt(item.price) * item.quantity, 0)
              const totalPrice = subtotal - (order.discountAmount || 0)

              const orderElement = document.createElement("div")
              orderElement.className = "history-item"

              let itemsHtml = ""
              order.items.forEach((item) => {
                itemsHtml += `
                                <div class="history-item-detail">
                                    <span>${item.name} x${item.quantity}</span>
                                    <span>Rp ${formatPrice(Number.parseInt(item.price) * item.quantity)}</span>
                                </div>
                            `
              })

              orderElement.innerHTML = `
                            <div class="history-item-header">
                                <h4>Pesanan #${orderHistory.length - index}</h4>
                                <span>${orderDate}</span>
                            </div>
                            <div class="history-item-content">
                                ${itemsHtml}
                            </div>
                            <div class="history-item-footer">
                                <span>Total: Rp ${formatPrice(totalPrice)}</span>
                                <span>Pembayaran: ${order.paymentMethod}</span>
                            </div>
                            <button class="btn btn-sm btn-outline reorder-btn" data-index="${index}">
                                <i class="fas fa-redo"></i> Pesan Lagi
                            </button>
                        `

              historyList.appendChild(orderElement)
            })

            // Add event listeners to reorder buttons
            document.querySelectorAll(".reorder-btn").forEach((btn) => {
              btn.addEventListener("click", function () {
                const index = Number.parseInt(this.dataset.index)
                const order = orderHistory[index]

                // Set current order to this past order
                localStorage.setItem("orderItems", JSON.stringify(order.items))
                localStorage.setItem("paymentMethod", order.paymentMethod)

                // Show toast and update UI
                showToast("Pesanan ditambahkan ke keranjang!")
                updateOrderSummary()
                updateCartCount()
                checkConfirmButton()

                // Close modal
                historyModal.style.display = "none"
              })
            })
          }

          historyModal.style.display = "block"
        }

        showHistoryBtn.addEventListener("click", showHistory)

        closeBtn.addEventListener("click", () => {
          historyModal.style.display = "none"
        })

        window.addEventListener("click", (event) => {
          if (event.target === historyModal) {
            historyModal.style.display = "none"
          }
        })
      }
    })
    </script>
</body>
</html>
