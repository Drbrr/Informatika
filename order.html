<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesan - Kantin Digital</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <nav class="navbar">
            <div class="container">
                <a href="index.html" class="navbar-brand">
                    <i class="fas fa-utensils"></i> Kantin Digital
                </a>
                <div class="navbar-links">
                    <a href="index.html">Beranda</a>
                    <a href="#" id="show-history">Riwayat</a>
                    <a href="#" id="cart-icon" class="cart-icon">
                        <i class="fas fa-shopping-cart"></i>
                        <span id="cart-count" class="cart-count">0</span>
                    </a>
                </div>
            </div>
        </nav>

        <main class="container">
            <h1 class="page-title">Menu Pesanan</h1>
            
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="search-input" placeholder="Cari menu...">
                    <button id="clear-search" class="clear-search">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <div class="order-grid">
                <!-- Menu Selection Section -->
                <div class="menu-section">
                    <div class="tabs">
                        <button class="tab-btn active" id="food-tab-btn" onclick="showTab(0)">
                            <i class="fas fa-hamburger"></i> Makanan
                        </button>
                        <button class="tab-btn" id="drink-tab-btn" onclick="showTab(1)">
                            <i class="fas fa-coffee"></i> Minuman
                        </button>
                        <button class="tab-btn" id="payment-tab-btn" onclick="showTab(2)">
                            <i class="fas fa-wallet"></i> Pembayaran
                        </button>
                    </div>

                    <!-- Food Menu Tab -->
                    <div class="tab-content active" id="food-tab">
                        <div class="menu-items" id="food-items">
                            <div class="menu-item" data-id="1" data-name="Nasi Goreng" data-price="15000" data-category="food">
                                <div class="menu-item-image food-1"></div>
                                <div class="menu-item-details">
                                    <h3>Nasi Goreng</h3>
                                    <p class="menu-item-price">Rp 15.000</p>
                                    <p class="menu-item-description">Nasi goreng spesial dengan telur dan ayam</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus" onclick="decreaseQuantity(this)">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus" onclick="increaseQuantity(this)">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item-btn" onclick="addToCart(this)">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                            <div class="menu-item" data-id="2" data-name="Mie Goreng" data-price="12000" data-category="food">
                                <div class="menu-item-image food-2"></div>
                                <div class="menu-item-details">
                                    <h3>Mie Goreng</h3>
                                    <p class="menu-item-price">Rp 12.000</p>
                                    <p class="menu-item-description">Mie goreng dengan telur dan sayuran</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus" onclick="decreaseQuantity(this)">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus" onclick="increaseQuantity(this)">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item-btn" onclick="addToCart(this)">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                            <div class="menu-item" data-id="3" data-name="Ayam Geprek" data-price="10000" data-category="food">
                                <div class="menu-item-image food-3"></div>
                                <div class="menu-item-details">
                                    <h3>Ayam Geprek</h3>
                                    <p class="menu-item-price">Rp 10.000</p>
                                    <p class="menu-item-description">Ayam geprek pedas dengan sambal spesial</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus" onclick="decreaseQuantity(this)">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus" onclick="increaseQuantity(this)">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item-btn" onclick="addToCart(this)">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                            <div class="menu-item" data-id="4" data-name="Sate Ayam" data-price="20000" data-category="food">
                                <div class="menu-item-image food-4"></div>
                                <div class="menu-item-details">
                                    <h3>Sate Ayam</h3>
                                    <p class="menu-item-price">Rp 20.000</p>
                                    <p class="menu-item-description">Sate ayam dengan bumbu kacang</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus" onclick="decreaseQuantity(this)">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus" onclick="increaseQuantity(this)">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item-btn" onclick="addToCart(this)">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                            <div class="menu-item" data-id="5" data-name="Sate Sapi" data-price="22000" data-category="food">
                                <div class="menu-item-image food-5"></div>
                                <div class="menu-item-details">
                                    <h3>Sate Sapi</h3>
                                    <p class="menu-item-price">Rp 22.000</p>
                                    <p class="menu-item-description">Sate sapi dengan bumbu kacang spesial</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus" onclick="decreaseQuantity(this)">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus" onclick="increaseQuantity(this)">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item-btn" onclick="addToCart(this)">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Drink Menu Tab -->
                    <div class="tab-content" id="drink-tab">
                        <div class="menu-items" id="drink-items">
                            <div class="menu-item" data-id="1" data-name="Es Teh" data-price="5000" data-category="drink">
                                <div class="menu-item-image drink-1"></div>
                                <div class="menu-item-details">
                                    <h3>Es Teh</h3>
                                    <p class="menu-item-price">Rp 5.000</p>
                                    <p class="menu-item-description">Es teh manis segar</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus" onclick="decreaseQuantity(this)">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus" onclick="increaseQuantity(this)">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item-btn" onclick="addToCart(this)">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                            <div class="menu-item" data-id="2" data-name="Es Jeruk" data-price="6000" data-category="drink">
                                <div class="menu-item-image drink-2"></div>
                                <div class="menu-item-details">
                                    <h3>Es Jeruk</h3>
                                    <p class="menu-item-price">Rp 6.000</p>
                                    <p class="menu-item-description">Es jeruk segar dengan jeruk pilihan</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus" onclick="decreaseQuantity(this)">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus" onclick="increaseQuantity(this)">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item-btn" onclick="addToCart(this)">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                            <div class="menu-item" data-id="3" data-name="Susu Coklat" data-price="8000" data-category="drink">
                                <div class="menu-item-image drink-3"></div>
                                <div class="menu-item-details">
                                    <h3>Susu Coklat</h3>
                                    <p class="menu-item-price">Rp 8.000</p>
                                    <p class="menu-item-description">Susu coklat dingin</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus" onclick="decreaseQuantity(this)">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus" onclick="increaseQuantity(this)">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item-btn" onclick="addToCart(this)">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                            <div class="menu-item" data-id="4" data-name="Susu Vanilla" data-price="8000" data-category="drink">
                                <div class="menu-item-image drink-4"></div>
                                <div class="menu-item-details">
                                    <h3>Susu Vanilla</h3>
                                    <p class="menu-item-price">Rp 8.000</p>
                                    <p class="menu-item-description">Susu vanilla dingin</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus" onclick="decreaseQuantity(this)">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus" onclick="increaseQuantity(this)">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item-btn" onclick="addToCart(this)">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                            <div class="menu-item" data-id="5" data-name="Air Mineral" data-price="4000" data-category="drink">
                                <div class="menu-item-image drink-5"></div>
                                <div class="menu-item-details">
                                    <h3>Air Mineral</h3>
                                    <p class="menu-item-price">Rp 4.000</p>
                                    <p class="menu-item-description">Air mineral segar</p>
                                    <div class="quantity-control">
                                        <button class="quantity-btn minus" onclick="decreaseQuantity(this)">-</button>
                                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                                        <button class="quantity-btn plus" onclick="increaseQuantity(this)">+</button>
                                    </div>
                                </div>
                                <button class="btn btn-primary add-item-btn" onclick="addToCart(this)">
                                    <i class="fas fa-plus"></i> Tambah
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Method Tab -->
                    <div class="tab-content" id="payment-tab">
                        <div class="payment-methods">
                            <h3 class="section-title">Pilih Metode Pembayaran</h3>
                            
                            <div class="payment-option" data-payment="QRIS">
                                <input type="radio" id="qris" name="payment" value="QRIS" onclick="selectPayment('QRIS')">
                                <label for="qris">
                                    <i class="fas fa-qrcode"></i>
                                    <span>QRIS</span>
                                    <p class="payment-description">Bayar dengan scan QR code</p>
                                </label>
                            </div>
                            
                            <div class="payment-option" data-payment="CASH">
                                <input type="radio" id="cash" name="payment" value="CASH" onclick="selectPayment('CASH')">
                                <label for="cash">
                                    <i class="fas fa-money-bill-wave"></i>
                                    <span>CASH</span>
                                    <p class="payment-description">Bayar dengan uang tunai</p>
                                </label>
                            </div>

                            <div class="discount-section">
                                <h3 class="section-title">Kode Promo</h3>
                                <div class="discount-input">
                                    <input type="text" id="discount-code" placeholder="Masukkan kode promo">
                                    <button id="apply-discount" class="btn btn-outline" onclick="applyDiscount()">Terapkan</button>
                                </div>
                                <p id="discount-message" class="discount-message"></p>
                            </div>
                        </div>
                    </div>

                    <div class="tab-navigation">
                        <button id="prev-tab" class="btn btn-outline" onclick="navigateTab('prev')">
                            <i class="fas fa-arrow-left"></i> Sebelumnya
                        </button>
                        <button id="next-tab" class="btn btn-primary" onclick="navigateTab('next')">
                            Selanjutnya <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Order Summary Section -->
                <div class="order-summary" id="order-summary">
                    <div class="summary-header">
                        <h2>Ringkasan Pesanan</h2>
                        <button id="clear-cart" class="btn btn-text" onclick="showClearCartModal()">
                            <i class="fas fa-trash"></i> Kosongkan
                        </button>
                    </div>
                    
                    <div id="order-items" class="order-items">
                        <p class="empty-order">Belum Ada Pesanan</p>
                    </div>
                    
                    <div class="summary-details">
                        <div class="summary-row">
                            <span>Subtotal</span>
                            <span id="subtotal">Rp 0</span>
                        </div>
                        <div class="summary-row" id="discount-row" style="display: none;">
                            <span>Diskon</span>
                            <span id="discount-amount">-Rp 0</span>
                        </div>
                        <div class="summary-row total">
                            <span>Total</span>
                            <span id="total-price">Rp 0</span>
                        </div>
                    </div>
                    
                    <div class="payment-info">
                        <i class="fas fa-wallet"></i>
                        <span>Metode Pembayaran:</span>
                        <span id="selected-payment">Belum Memilih</span>
                    </div>
                    
                    <button id="confirm-order" class="btn btn-primary btn-lg btn-full" onclick="showConfirmModal()">
                        <i class="fas fa-check-circle"></i> Konfirmasi Pesanan
                    </button>
                </div>
            </div>
        </main>

        <footer class="footer">
            <div class="container">
                <p>&copy; 2024 Kantin Digital. All rights reserved.</p>
                <div class="footer-links">
                    <a href="#" onclick="showAboutModal(); return false;">About Us</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Mobile Cart Button -->
    <button id="mobile-cart-btn" class="mobile-cart-btn" onclick="toggleMobileCart()">
        <i class="fas fa-shopping-cart"></i>
        <span id="mobile-cart-count">0</span>
    </button>

    <!-- Order History Modal -->
    <div id="history-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Riwayat Pesanan</h2>
                <span class="close" onclick="closeHistoryModal()">&times;</span>
            </div>
            <div class="modal-body" id="history-list">
                <!-- Order history will be populated here -->
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Konfirmasi Pesanan</h2>
                <span class="close-confirm" onclick="closeConfirmModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p>Apakah Anda yakin ingin mengonfirmasi pesanan ini?</p>
                <div class="modal-buttons">
                    <button id="cancel-confirm" class="btn btn-outline" onclick="closeConfirmModal()">Batal</button>
                    <button id="proceed-confirm" class="btn btn-primary" onclick="confirmOrder()">Ya, Konfirmasi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Clear Cart Modal -->
    <div id="clear-cart-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Kosongkan Keranjang</h2>
                <span class="close-clear-cart" onclick="closeClearCartModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p>Apakah Anda yakin ingin mengosongkan keranjang?</p>
                <div class="modal-buttons">
                    <button id="cancel-clear" class="btn btn-outline" onclick="closeClearCartModal()">Batal</button>
                    <button id="proceed-clear" class="btn btn-primary" onclick="clearCart()">Ya, Kosongkan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- About Us Modal -->
    <div id="about-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>About Us</h2>
                <span class="close-about">&times;</span>
            </div>
            <div class="modal-body">
                <div class="about-content">
                    <div class="about-logo">
                        <i class="fas fa-utensils"></i> Kantin Digital
                    </div>
                    <p>Kantin Digital adalah sistem pemesanan makanan dan minuman online yang dirancang untuk memudahkan proses pemesanan di kantin. Aplikasi ini memungkinkan pengguna untuk memesan makanan dan minuman dengan cepat dan mudah tanpa perlu mengantri.</p>
                
                    <h3>Fitur Utama</h3>
                    <ul>
                        <li>Pemesanan makanan dan minuman secara online</li>
                        <li>Pembayaran dengan QRIS atau tunai</li>
                        <li>Riwayat pesanan untuk pemesanan ulang dengan cepat</li>
                        <li>Kode promo untuk diskon</li>
                        <li>Cetak struk pesanan</li>
                    </ul>
                    
                    <h3>Cara Penggunaan</h3>
                    <ol>
                        <li>Pilih menu makanan atau minuman yang diinginkan</li>
                        <li>Tentukan jumlah yang ingin dipesan</li>
                        <li>Klik tombol "Tambah" untuk menambahkan ke keranjang</li>
                        <li>Pilih metode pembayaran yang diinginkan</li>
                        <li>Klik "Konfirmasi Pesanan" untuk menyelesaikan pemesanan</li>
                    </ol>
                    
                    <h3>Tentang Pengembang</h3>
                    <p>Aplikasi Kantin Digital ini dikembangkan sebagai solusi untuk mempercepat proses pemesanan makanan dan minuman di kantin. Kami berkomitmen untuk terus mengembangkan aplikasi ini dengan menambahkan fitur-fitur baru yang bermanfaat bagi pengguna.</p>
                    
                    <h3>Hubungi Kami</h3>
                    <p>Email: support@kantindigital.com</p>
                    <p>Telepon: (021) 1234-5678</p>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
// Global variables
let orderItems = [];
let paymentMethod = "";
let discountAmount = 0;
let currentTabIndex = 0;

// Format price with thousand separators
function formatPrice(price) {
  return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

// Show toast notification
function showToast(message, duration = 3000) {
  const toast = document.getElementById("toast");
  toast.textContent = message;
  toast.classList.add("show");

  setTimeout(() => {
    toast.classList.remove("show");
  }, duration);
}

// Initialize the app
document.addEventListener("DOMContentLoaded", function() {
  console.log("Document loaded");
  
  // Load data from localStorage
  loadFromLocalStorage();
  
  // Initialize UI
  updateOrderSummary();
  updatePaymentDisplay();
  updateCartCount();
  
  // Set initial tab
  const urlParams = new URLSearchParams(window.location.search);
  const initialTab = urlParams.get("tab");
  
  if (initialTab === "drink") {
    showTab(1); // Show drinks tab
  } else if (initialTab === "payment") {
    showTab(2); // Show payment tab
  } else {
    showTab(0); // Default to food tab
  }
  
  // Setup history modal
  setupHistoryModal();
  
  // Check if confirm button should be enabled
  checkConfirmButton();
});

// Load data from localStorage
function loadFromLocalStorage() {
  try {
    const storedItems = localStorage.getItem("orderItems");
    if (storedItems) {
      orderItems = JSON.parse(storedItems);
      console.log("Loaded items from localStorage:", orderItems);
    }
    
    paymentMethod = localStorage.getItem("paymentMethod") || "";
    discountAmount = Number.parseInt(localStorage.getItem("discountAmount") || "0");
  } catch (error) {
    console.error("Error loading from localStorage:", error);
    orderItems = [];
    paymentMethod = "";
    discountAmount = 0;
  }
}

// Save data to localStorage
function saveToLocalStorage() {
  try {
    localStorage.setItem("orderItems", JSON.stringify(orderItems));
    localStorage.setItem("paymentMethod", paymentMethod);
    localStorage.setItem("discountAmount", discountAmount.toString());
    console.log("Saved to localStorage:", orderItems);
  } catch (error) {
    console.error("Error saving to localStorage:", error);
  }
}

// Add to cart function
function addToCart(button) {
  const menuItem = button.closest(".menu-item");
  const id = menuItem.dataset.id;
  const name = menuItem.dataset.name;
  const price = menuItem.dataset.price;
  const category = menuItem.dataset.category;
  const quantityInput = menuItem.querySelector(".quantity-input");
  const quantity = Number.parseInt(quantityInput.value);

  console.log("Adding to cart:", { id, name, price, category, quantity });

  // Check if item already exists in order
  const existingItemIndex = orderItems.findIndex(
    (item) => item.id === id && item.category === category
  );

  if (existingItemIndex !== -1) {
    // Update quantity if item exists
    orderItems[existingItemIndex].quantity += quantity;
  } else {
    // Add new item
    orderItems.push({ id, name, price, category, quantity });
  }

  // Save to localStorage
  saveToLocalStorage();

  // Reset quantity input
  quantityInput.value = 1;

  // Show toast notification
  showToast(`${name} ditambahkan ke pesanan!`);

  // Update UI
  updateOrderSummary();
  updateCartCount();
  checkConfirmButton();
}

// Increase quantity
function increaseQuantity(button) {
  const input = button.parentElement.querySelector(".quantity-input");
  let value = Number.parseInt(input.value);
  input.value = Math.min(value + 1, 10);
}

// Decrease quantity
function decreaseQuantity(button) {
  const input = button.parentElement.querySelector(".quantity-input");
  let value = Number.parseInt(input.value);
  input.value = Math.max(value - 1, 1);
}

// Select payment method
function selectPayment(method) {
  paymentMethod = method;
  saveToLocalStorage();
  updatePaymentDisplay();
  checkConfirmButton();
  showToast(`Metode pembayaran diubah ke ${paymentMethod}`);
}

// Apply discount code
function applyDiscount() {
  const discountCodeInput = document.getElementById("discount-code");
  const discountMessage = document.getElementById("discount-message");
  const code = discountCodeInput.value.trim().toUpperCase();

  if (code === "DISKON10") {
    // Calculate 10% discount
    const subtotal = orderItems.reduce(
      (total, item) => total + Number.parseInt(item.price) * item.quantity,
      0
    );
    discountAmount = Math.round(subtotal * 0.1);
    saveToLocalStorage();

    discountMessage.textContent = "Diskon 10% berhasil diterapkan!";
    discountMessage.style.color = "green";

    showToast("Kode promo berhasil diterapkan!");
    updateOrderSummary();
  } else if (code === "DISKON20") {
    // Calculate 20% discount
    const subtotal = orderItems.reduce(
      (total, item) => total + Number.parseInt(item.price) * item.quantity,
      0
    );
    discountAmount = Math.round(subtotal * 0.2);
    saveToLocalStorage();

    discountMessage.textContent = "Diskon 20% berhasil diterapkan!";
    discountMessage.style.color = "green";

    showToast("Kode promo berhasil diterapkan!");
    updateOrderSummary();
  } else {
    discountMessage.textContent = "Kode promo tidak valid.";
    discountMessage.style.color = "red";
  }
}

// Show tab
function showTab(index) {
  console.log("Switching to tab:", index);
  const tabButtons = document.querySelectorAll(".tab-btn");
  const tabContents = document.querySelectorAll(".tab-content");
  const prevTabBtn = document.getElementById("prev-tab");
  const nextTabBtn = document.getElementById("next-tab");

  tabButtons.forEach((btn) => btn.classList.remove("active"));
  tabContents.forEach((content) => content.classList.remove("active"));

  tabButtons[index].classList.add("active");
  tabContents[index].classList.add("active");
  currentTabIndex = index;

  // Update navigation buttons
  prevTabBtn.style.visibility = index === 0 ? "hidden" : "visible";
  nextTabBtn.style.visibility = index === tabButtons.length - 1 ? "hidden" : "visible";
}

// Navigate tabs
function navigateTab(direction) {
  const tabButtons = document.querySelectorAll(".tab-btn");
  
  if (direction === "next" && currentTabIndex < tabButtons.length - 1) {
    showTab(currentTabIndex + 1);
  } else if (direction === "prev" && currentTabIndex > 0) {
    showTab(currentTabIndex - 1);
  }
}

// Toggle mobile cart
function toggleMobileCart() {
  const orderSummary = document.getElementById("order-summary");
  orderSummary.classList.toggle("show-mobile");
}

// Show confirm modal
function showConfirmModal() {
  if (orderItems.length > 0 && paymentMethod) {
    document.getElementById("confirm-modal").style.display = "block";
  } else {
    if (orderItems.length === 0) {
      showToast("Silakan pilih menu terlebih dahulu!");
    } else if (!paymentMethod) {
      showToast("Silakan pilih metode pembayaran!");
      showTab(2); // Show payment tab
    }
  }
}

// Close confirm modal
function closeConfirmModal() {
  document.getElementById("confirm-modal").style.display = "none";
}

// Confirm order
function confirmOrder() {
  // Save order time
  localStorage.setItem("orderTime", new Date().toISOString());

  // Redirect to confirmation page
  window.location.href = "confirmation.html";
}

// Show clear cart modal
function showClearCartModal() {
  if (orderItems.length > 0) {
    document.getElementById("clear-cart-modal").style.display = "block";
  }
}

// Close clear cart modal
function closeClearCartModal() {
  document.getElementById("clear-cart-modal").style.display = "none";
}

// Clear cart
function clearCart() {
  orderItems = [];
  discountAmount = 0;
  saveToLocalStorage();

  updateOrderSummary();
  updateCartCount();
  checkConfirmButton();

  document.getElementById("clear-cart-modal").style.display = "none";
  showToast("Keranjang berhasil dikosongkan!");
}

// Update order summary display
function updateOrderSummary() {
  const orderItemsContainer = document.getElementById("order-items");
  const subtotalElement = document.getElementById("subtotal");
  const discountRow = document.getElementById("discount-row");
  const discountAmountElement = document.getElementById("discount-amount");
  const totalPriceElement = document.getElementById("total-price");

  // Clear current items
  orderItemsContainer.innerHTML = "";

  console.log("Updating order summary with items:", orderItems);

  if (orderItems.length === 0) {
    orderItemsContainer.innerHTML = '<p class="empty-order">Belum Ada Pesanan</p>';
    subtotalElement.textContent = "Rp 0";
    totalPriceElement.textContent = "Rp 0";
    discountRow.style.display = "none";
    return;
  }

  // Calculate subtotal
  let subtotal = 0;

  // Add each item to the display
  orderItems.forEach((item, index) => {
    const price = Number.parseInt(item.price);
    const itemTotal = price * item.quantity;
    subtotal += itemTotal;

    const itemElement = document.createElement("div");
    itemElement.className = "order-item";
    itemElement.innerHTML = `
      <div class="order-item-details">
        <div class="order-item-name">${item.name}</div>
        <div class="order-item-price">Rp ${formatPrice(price)} x ${item.quantity}</div>
      </div>
      <div class="order-item-total">Rp ${formatPrice(itemTotal)}</div>
      <button class="remove-item" onclick="removeItem(${index})">
        <i class="fas fa-times"></i>
      </button>
    `;
    orderItemsContainer.appendChild(itemElement);
  });

  // Update subtotal
  subtotalElement.textContent = `Rp ${formatPrice(subtotal)}`;

  // Update discount if applicable
  if (discountAmount > 0) {
    discountRow.style.display = "flex";
    discountAmountElement.textContent = `-Rp ${formatPrice(discountAmount)}`;
  } else {
    discountRow.style.display = "none";
  }

  // Calculate and update total price
  const totalPrice = subtotal - discountAmount;
  totalPriceElement.textContent = `Rp ${formatPrice(totalPrice)}`;
}

// Remove item from cart
function removeItem(index) {
  const removedItem = orderItems[index];
  orderItems.splice(index, 1);
  saveToLocalStorage();

  showToast(`${removedItem.name} dihapus dari pesanan!`);

  updateOrderSummary();
  updateCartCount();
  checkConfirmButton();
}

// Update payment method display
function updatePaymentDisplay() {
  const paymentDisplay = document.getElementById("selected-payment");
  paymentDisplay.textContent = paymentMethod || "Belum Memilih";
}

// Update cart count
function updateCartCount() {
  const cartCount = document.getElementById("cart-count");
  const mobileCartCount = document.getElementById("mobile-cart-count");
  const mobileCartBtn = document.getElementById("mobile-cart-btn");
  const totalItems = orderItems.reduce((total, item) => total + item.quantity, 0);

  cartCount.textContent = totalItems;
  mobileCartCount.textContent = totalItems;

  if (totalItems > 0) {
    mobileCartBtn.style.display = "flex";
  } else {
    mobileCartBtn.style.display = "none";
  }
}

// Check if confirm button should be enabled
function checkConfirmButton() {
  const confirmBtn = document.getElementById("confirm-order");
  confirmBtn.disabled = !(orderItems.length > 0 && paymentMethod);
}

// Setup history modal
function setupHistoryModal() {
  const historyModal = document.getElementById("history-modal");
  const showHistoryBtn = document.getElementById("show-history");
  
  showHistoryBtn.addEventListener("click", function() {
    showHistory();
  });
}

// Show history
function showHistory() {
  const historyModal = document.getElementById("history-modal");
  const historyList = document.getElementById("history-list");
  
  // Get order history from localStorage
  const orderHistory = JSON.parse(localStorage.getItem("orderHistory") || "[]");

  // Clear previous content
  historyList.innerHTML = "";

  if (orderHistory.length === 0) {
    historyList.innerHTML = '<p class="text-center">Belum ada riwayat pesanan.</p>';
  } else {
    // Display order history
    orderHistory.forEach((order, index) => {
      const orderDate = new Date(order.timestamp).toLocaleString("id-ID");
      const subtotal = order.items.reduce(
        (sum, item) => sum + Number.parseInt(item.price) * item.quantity,
        0
      );
      const totalPrice = subtotal - (order.discountAmount || 0);

      const orderElement = document.createElement("div");
      orderElement.className = "history-item";

      let itemsHtml = "";
      order.items.forEach((item) => {
        itemsHtml += `
          <div class="history-item-detail">
            <span>${item.name} x${item.quantity}</span>
            
          </div>
        `;
      });

      orderElement.innerHTML = `
        <div class="history-item-header">
          <h4>Pesanan #${orderHistory.length - index}</h4>
          <span>${orderDate}</span>
        </div>
        <div class="history-item-content">
          ${itemsHtml}
        </div>
        <div class="history-item-footer">
          <span>Total: Rp ${formatPrice(totalPrice)}</span>
          <span>Pembayaran: ${order.paymentMethod}</span>
        </div>
        <button class="btn btn-sm btn-outline reorder-btn" onclick="reorder(${index})">
          <i class="fas fa-redo"></i> Pesan Lagi
        </button>
      `;

      historyList.appendChild(orderElement);
    });
  }

  historyModal.style.display = "block";
}

// Close history modal
function closeHistoryModal() {
  document.getElementById("history-modal").style.display = "none";
}

// Reorder from history
function reorder(index) {
  const orderHistory = JSON.parse(localStorage.getItem("orderHistory") || "[]");
  const order = orderHistory[index];

  // Set current order to this past order
  orderItems = [...order.items];
  paymentMethod = order.paymentMethod;
  saveToLocalStorage();

  // Show toast and update UI
  showToast("Pesanan ditambahkan ke keranjang!");
  updateOrderSummary();
  updateCartCount();
  checkConfirmButton();

  // Close modal
  closeHistoryModal();
}

// About Us Modal
function showAboutModal() {
  const aboutModal = document.getElementById('about-modal');
  aboutModal.style.display = 'block';
}

// Close About Us Modal
document.querySelector('.close-about').addEventListener('click', function() {
  document.getElementById('about-modal').style.display = 'none';
});

// Close modal when clicking outside
window.addEventListener('click', function(event) {
  const aboutModal = document.getElementById('about-modal');
  if (event.target === aboutModal) {
    aboutModal.style.display = 'none';
  }
});
</script>
</body>
</html>
